<svg xmlns="http://www.w3.org/2000/svg" width="1800" height="1040" viewBox="0 0 1800 1040" role="img" aria-labelledby="title desc">
  <title id="title">Kuruma-Logger ソフトウェア構成図</title>
  <desc id="desc">入力、解析、集約、出力、監視とライセンス制御の流れを分かりやすく示す図。</desc>

  <defs>
    <style>
      .bg { fill: #f7fafc; }
      .title { font: 700 42px 'Yu Gothic', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif; fill: #0f172a; }
      .zone-title { font: 700 24px 'Yu Gothic', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif; fill: #1e293b; }
      .box-title { font: 700 22px 'Yu Gothic', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif; fill: #0f172a; }
      .box-text { font: 500 18px 'Yu Gothic', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif; fill: #334155; }
      .label { font: 600 16px 'Yu Gothic', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif; fill: #1d4ed8; }
      .note { font: 500 18px 'Yu Gothic', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif; fill: #334155; }
      .zone-input { fill: #eff6ff; stroke: #93c5fd; stroke-width: 2; }
      .zone-proc { fill: #f0fdf4; stroke: #86efac; stroke-width: 2; }
      .zone-out { fill: #fff7ed; stroke: #fdba74; stroke-width: 2; }
      .zone-mgr { fill: #f5f3ff; stroke: #c4b5fd; stroke-width: 2; }
      .box { fill: #ffffff; stroke: #cbd5e1; stroke-width: 2.2; }
      .main-box { fill: #dbeafe; stroke: #3b82f6; stroke-width: 2.6; }
      .line { stroke: #2563eb; stroke-width: 2.8; fill: none; }
      .line-dash { stroke: #7c3aed; stroke-width: 2.4; fill: none; stroke-dasharray: 8 6; }
      .icon { stroke: #1e293b; stroke-width: 2.6; fill: none; stroke-linecap: round; stroke-linejoin: round; }
      .icon-fill { fill: #1e293b; }
    </style>
    <marker id="arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L8,4 L0,8 z" fill="#2563eb" />
    </marker>
    <marker id="arrow-dash" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L8,4 L0,8 z" fill="#7c3aed" />
    </marker>
  </defs>

  <rect class="bg" x="0" y="0" width="1800" height="1040" />

  <text class="title" x="60" y="72">Kuruma-Logger ソフトウェア構成図</text>

  <!-- zones -->
  <rect class="zone-input" x="60" y="170" width="360" height="460" rx="16" />
  <text class="zone-title" x="84" y="206">1. 入力</text>

  <rect class="zone-proc" x="470" y="170" width="700" height="460" rx="16" />
  <text class="zone-title" x="494" y="206">2. 解析と集約</text>

  <rect class="zone-out" x="1230" y="170" width="500" height="460" rx="16" />
  <text class="zone-title" x="1254" y="206">3. 出力</text>

  <rect class="zone-mgr" x="60" y="680" width="1670" height="300" rx="16" />
  <text class="zone-title" x="84" y="716">4. 監視と機能制御</text>

  <!-- input boxes -->
  <rect class="box" x="100" y="240" width="290" height="100" rx="12" />
  <text class="box-title" x="166" y="278">CAN Driver</text>
  <text class="box-text" x="136" y="308">車両データを受信</text>
  <g class="icon" transform="translate(116 258)">
    <rect x="0" y="8" width="16" height="16" rx="3" />
    <path d="M16 16 H30" />
    <path d="M30 11 V21" />
    <path d="M35 11 V21" />
  </g>

  <rect class="box" x="100" y="360" width="290" height="100" rx="12" />
  <text class="box-title" x="168" y="398">GPS Driver</text>
  <text class="box-text" x="153" y="428">位置・速度を受信</text>
  <g class="icon" transform="translate(116 378)">
    <path d="M16 0 C7 0 0 7 0 16 C0 27 16 40 16 40 C16 40 32 27 32 16 C32 7 25 0 16 0 Z" />
    <circle cx="16" cy="16" r="4.5" />
  </g>

  <rect class="box" x="100" y="480" width="290" height="100" rx="12" />
  <text class="box-title" x="168" y="518">PPS Driver</text>
  <text class="box-text" x="125" y="548">時刻同期パルスを受信</text>
  <g class="icon" transform="translate(116 498)">
    <circle cx="16" cy="16" r="14" />
    <path d="M16 16 L16 8" />
    <path d="M16 16 L23 20" />
  </g>

  <!-- process boxes -->
  <rect class="box" x="540" y="250" width="280" height="110" rx="12" />
  <text class="box-title" x="638" y="292">Parser群</text>
  <text class="box-text" x="614" y="322">入力形式を解析</text>

  <rect class="box" x="880" y="250" width="250" height="110" rx="12" />
  <text class="box-title" x="954" y="292">PpsTimer</text>
  <text class="box-text" x="916" y="322">25Hzタイミング生成</text>

  <rect class="main-box" x="700" y="400" width="300" height="130" rx="14" />
  <text class="box-title" x="765" y="442">DataAggregator</text>
  <text class="box-text" x="740" y="472">データを25Hzで集約</text>

  <rect class="box" x="550" y="560" width="600" height="110" rx="12" />
  <text class="box-title" x="760" y="602">DataBus / SnapshotStore</text>
  <text class="box-text" x="748" y="632">最新状態を保持して配信</text>

  <!-- output boxes -->
  <rect class="box" x="1280" y="240" width="400" height="100" rx="12" />
  <text class="box-title" x="1458" y="282">GUI</text>
  <text class="box-text" x="1420" y="312">本体画面に表示</text>

  <rect class="box" x="1280" y="370" width="400" height="100" rx="12" />
  <text class="box-title" x="1430" y="412">StorageService</text>
  <text class="box-text" x="1424" y="442">SDへログ保存</text>

  <rect class="box" x="1280" y="500" width="400" height="100" rx="12" />
  <text class="box-title" x="1432" y="542">TCP / MQTT</text>
  <text class="box-text" x="1388" y="572">外部アプリへデータ送信</text>

  <!-- management boxes -->
  <rect class="box" x="110" y="760" width="430" height="110" rx="12" />
  <text class="box-title" x="240" y="802">StatusAggregator</text>
  <text class="box-text" x="238" y="832">機器状態を集約</text>

  <rect class="box" x="620" y="760" width="480" height="110" rx="12" />
  <text class="box-title" x="758" y="802">SystemStatusManager</text>
  <text class="box-text" x="760" y="832">異常監視・時刻同期</text>

  <rect class="box" x="1180" y="760" width="500" height="110" rx="12" />
  <text class="box-title" x="1364" y="793">License +</text>
  <text class="box-title" x="1308" y="820">FeatureControl</text>
  <text class="box-text" x="1300" y="848">機能の有効/無効を制御</text>

  <!-- arrows: input -> process -->
  <path class="line" d="M390 290 H540" marker-end="url(#arrow)" />
  <path class="line" d="M390 410 C480 410, 470 305, 540 305" marker-end="url(#arrow)" />
  <path class="line" d="M390 530 C660 530, 650 305, 880 305" marker-end="url(#arrow)" />

  <!-- arrows: process -> aggregation -->
  <path class="line" d="M680 360 V400" marker-end="url(#arrow)" />
  <path class="line" d="M1005 360 V400" marker-end="url(#arrow)" />
  <text class="label" x="1018" y="388">25Hz</text>

  <path class="line" d="M850 530 V560" marker-end="url(#arrow)" />

  <!-- arrows: data bus -> outputs (clear targets) -->
  <path class="line" d="M1150 590 C1240 590, 1210 290, 1280 290" marker-end="url(#arrow)" />
  <path class="line" d="M1150 610 C1230 610, 1220 420, 1280 420" marker-end="url(#arrow)" />
  <path class="line" d="M1150 630 C1230 630, 1220 550, 1280 550" marker-end="url(#arrow)" />
  <text class="label" x="1164" y="574">データ配信</text>

  <!-- arrows: monitoring/control -->
  <path class="line" d="M600 670 C500 700, 420 720, 325 760" marker-end="url(#arrow)" />
  <path class="line" d="M850 670 V760" marker-end="url(#arrow)" />
  <path class="line" d="M540 815 H620" marker-end="url(#arrow)" />
  <path class="line" d="M1100 815 H1180" marker-end="url(#arrow)" />

  <path class="line-dash" d="M1430 760 V420 H1280" marker-end="url(#arrow-dash)" />
  <path class="line-dash" d="M1510 760 V550 H1280" marker-end="url(#arrow-dash)" />
  <text class="label" x="1462" y="610" fill="#7c3aed">機能ON/OFF</text>

  <text class="note" x="88" y="930">読み方: 左から右へ「入力 → 解析/集約 → 出力」。下段は全体を支える監視・制御レイヤーです。</text>
</svg>
